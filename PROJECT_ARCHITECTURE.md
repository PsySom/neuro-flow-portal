# –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Mental Balance

## üìã –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ü—Ä–æ–µ–∫—Ç**: Mental Balance - –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏  
**–¢–∏–ø**: Fullstack –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (React + Supabase)  
**URL –ø—Ä–æ–µ–∫—Ç–∞**: https://szvousyzsqdpubgfycdy.supabase.co  
**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: React 18, TypeScript, Vite, Tailwind CSS, Supabase, React Query

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
Frontend (React/Vite)
    ‚Üì
Supabase Client
    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Supabase Backend                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Database (PostgreSQL)            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Tables                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - RLS Policies                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Functions & Triggers           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Auth (Supabase Auth)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Email/Password                 ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Session Management             ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Realtime (WebSockets)            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Subscriptions                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - Broadcast                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ External Webhooks                ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ - n8n (mentalbalans.com)         ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞

### Frontend —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ components/           # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ ui/              # shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/       # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–∞—à–±–æ—Ä–¥–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-diary-scenarios/  # AI –î–Ω–µ–≤–Ω–∏–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai-chat/            # AI –ß–∞—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user-profile/       # –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ activity-timeline/  # –õ–µ–Ω—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ calendar/        # –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ diaries/         # –î–Ω–µ–≤–Ω–∏–∫–∏ (Mood, Sleep, OCD –∏ —Ç.–¥.)
‚îÇ   ‚îú‚îÄ‚îÄ practices/       # –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ onboarding/      # –û–Ω–±–æ—Ä–¥–∏–Ω–≥
‚îÇ   ‚îú‚îÄ‚îÄ auth/            # –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ statistics/      # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ contexts/            # React Context
‚îÇ   ‚îú‚îÄ‚îÄ SupabaseAuthContext.tsx
‚îÇ   ‚îú‚îÄ‚îÄ PersonalizationContext.tsx
‚îÇ   ‚îú‚îÄ‚îÄ ActivitiesContext.tsx
‚îÇ   ‚îî‚îÄ‚îÄ DiaryStatusContext.tsx
‚îÇ
‚îú‚îÄ‚îÄ hooks/               # Custom React Hooks
‚îÇ   ‚îú‚îÄ‚îÄ api/            # API —Ö—É–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useActivities.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useActivitiesApi.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useActivitiesRealtime.ts
‚îÇ   ‚îî‚îÄ‚îÄ use-*.ts        # –î—Ä—É–≥–∏–µ —Ö—É–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
‚îÇ   ‚îú‚îÄ‚îÄ ai-diary.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ activity.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ backend-auth.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ unified-activity.service.ts
‚îÇ
‚îú‚îÄ‚îÄ integrations/supabase/
‚îÇ   ‚îú‚îÄ‚îÄ client.ts        # Supabase –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ types.ts         # –ê–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ç–∏–ø—ã –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ activities.repo.ts
‚îÇ   ‚îú‚îÄ‚îÄ mood-diary.repo.ts
‚îÇ   ‚îî‚îÄ‚îÄ sleep-diary.repo.ts
‚îÇ
‚îú‚îÄ‚îÄ pages/               # –°—Ç—Ä–∞–Ω–∏—Ü—ã (—Ä–æ—É—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ Index.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Calendar.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Auth.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Practices.tsx
‚îÇ   ‚îî‚îÄ‚îÄ Statistics.tsx
‚îÇ
‚îú‚îÄ‚îÄ utils/               # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ types/               # TypeScript —Ç–∏–ø—ã
‚îî‚îÄ‚îÄ data/                # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase PostgreSQL)

### –¢–∞–±–ª–∏—Ü—ã –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

#### 1. **profiles** - –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
- id: uuid (PK, FK -> auth.users)
- email: text
- full_name: text
- avatar_url: text
- telegram_handle: text
- whatsapp_number: text
- facebook_url: text
- role: text
- created_at, updated_at: timestamp
```
**RLS Policies**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç/—Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—Ç –≤—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏

---

#### 2. **activities** - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
- id: uuid (PK)
- user_id: uuid (FK -> profiles.id)
- activity_type_id: integer (FK -> activity_types.id)
- title: text
- description: text
- start_time: timestamp
- end_time: timestamp
- status: text (planned|in_progress|completed|cancelled)
- metadata: jsonb
- created_at, updated_at: timestamp
```
**RLS Policies**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏

**–¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π** (activity_types):
- –†–∞–±–æ—Ç–∞, –û—Ç–¥—ã—Ö, –°–ø–æ—Ä—Ç, –û–±—â–µ–Ω–∏–µ, –•–æ–±–±–∏ –∏ —Ç.–¥.
- –ö–∞–∂–¥—ã–π —Ç–∏–ø –∏–º–µ–µ—Ç —Ü–≤–µ—Ç –∏ –∏–∫–æ–Ω–∫—É

---

#### 3. **activity_states** - –°–æ—Å—Ç–æ—è–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
```sql
- id: uuid (PK)
- activity_id: uuid (FK -> activities.id)
- user_id: uuid
- state: text (planned|in_progress|completed|cancelled)
- mood_before: integer (1-10)
- mood_after: integer (1-10)
- energy_before: integer (1-10)
- energy_after: integer (1-10)
- notes: text
- metadata: jsonb
- created_at, updated_at: timestamp
```
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ —ç–Ω–µ—Ä–≥–∏–∏ –¥–æ/–ø–æ—Å–ª–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

---

#### 4. **ai_diary_sessions** - –°–µ—Å—Å–∏–∏ AI –¥–Ω–µ–≤–Ω–∏–∫–∞
```sql
- id: uuid (PK)
- user_id: uuid (FK -> profiles.id)
- session_id: varchar (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- started_at: timestamp
- ended_at: timestamp (nullable)
- summary: text
- insights: jsonb
- emotional_state: jsonb
- created_at: timestamp
```

---

#### 5. **ai_diary_messages** - –°–æ–æ–±—â–µ–Ω–∏—è AI –¥–Ω–µ–≤–Ω–∏–∫–∞
```sql
- id: uuid (PK)
- user_id: uuid (FK -> profiles.id)
- session_id: varchar (FK -> ai_diary_sessions.session_id)
- message_type: varchar ('user' | 'ai')
- content: text
- metadata: jsonb (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å suggestions, topics –∏ —Ç.–¥.)
- created_at: timestamp
```

**Realtime –ø–æ–¥–ø–∏—Å–∫–∞**: –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–µ AI —Å–æ–æ–±—â–µ–Ω–∏—è

---

#### 6. **mood_diary_entries** - –ó–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
```sql
- id: uuid (PK)
- user_id: uuid
- mood_score: integer (1-10)
- emotions: jsonb (–º–∞—Å—Å–∏–≤ —ç–º–æ—Ü–∏–π —Å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é)
- triggers: text[] (—Ç—Ä–∏–≥–≥–µ—Ä—ã)
- physical_sensations: text[]
- body_areas: text[]
- context: text
- notes: text
- created_at, updated_at: timestamp
```

---

#### 7. **sleep_diary_entries** - –ó–∞–ø–∏—Å–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞ —Å–Ω–∞
```sql
- id: uuid (PK)
- user_id: uuid
- bedtime: time
- wake_up_time: time
- sleep_duration: numeric
- sleep_quality: integer (1-10)
- night_awakenings: integer
- morning_feeling: integer (1-10)
- has_day_rest: boolean
- day_rest_type: text
- day_rest_effectiveness: integer
- overall_sleep_impact: integer
- sleep_disruptors: text[]
- sleep_comment: text
- rest_comment: text
- recommendations: text[]
- created_at, updated_at: timestamp
```

---

#### 8. **practices** - –ü—Ä–∞–∫—Ç–∏–∫–∏ –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
```sql
- id: bigint (PK)
- title: text
- description: text
- category: text
- duration_minutes: integer
- difficulty_level: enum (beginner|intermediate|advanced)
- instructions: text[]
- benefits: text[]
- status: enum (draft|published|archived)
- created_by: uuid
- metadata: jsonb
- created_at, updated_at: timestamp
```

**RLS Policies**:
- –í—Å–µ –≤–∏–¥—è—Ç published –ø—Ä–∞–∫—Ç–∏–∫–∏
- –ê–¥–º–∏–Ω—ã —É–ø—Ä–∞–≤–ª—è—é—Ç –≤—Å–µ–º–∏ –ø—Ä–∞–∫—Ç–∏–∫–∞–º–∏

---

#### 9. **therapy_scenarios** - –¢–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
```sql
- id: uuid (PK)
- scenario_code: varchar (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥)
- scenario_type: varchar (morning|midday|evening)
- name: varchar
- description: text
- duration_minutes: integer
- priority: integer
- is_active: boolean
- created_at, updated_at: timestamp
```

---

#### 10. **therapy_questions** - –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Ä–∞–ø–∏–∏
```sql
- id: uuid (PK)
- scenario_id: uuid (FK -> therapy_scenarios.id)
- parent_question_id: uuid (nullable, –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏)
- question_code: varchar
- question_text: text
- question_type: varchar (scale|multiple-choice|multi-select|text|emoji-scale)
- sequence_number: integer
- metadata: jsonb (options, scaleRange –∏ —Ç.–¥.)
- created_at: timestamp
```

---

#### 11. **therapy_transitions** - –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –≤–æ–ø—Ä–æ—Å–∞–º–∏
```sql
- id: uuid (PK)
- from_question_id: uuid (FK -> therapy_questions.id)
- condition_type: varchar (exact_value|range|multi_contains –∏ —Ç.–¥.)
- condition_data: jsonb
- next_question_id: uuid (nullable)
- next_scenario_id: uuid (nullable)
- priority: integer
- created_at: timestamp
```

---

#### 12. **user_therapy_progress** - –ü—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
- id: uuid (PK)
- user_id: uuid
- session_id: varchar
- scenario_id: uuid
- current_question_id: uuid
- responses: jsonb
- metrics: jsonb (A, E, S, T scores)
- insights: jsonb
- completed_at: timestamp (nullable)
- created_at: timestamp
```

---

#### 13. **user_roles** - –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
- id: uuid (PK)
- user_id: uuid (FK -> profiles.id)
- role: enum (user|admin)
- created_at: timestamp
```

**Constraint**: –£–Ω–∏–∫–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞ (user_id, role)

---

#### 14. **profile_access_logs** - –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—è–º
```sql
- id: uuid (PK)
- admin_user_id: uuid
- accessed_user_id: uuid
- access_type: text (view|update|delete)
- accessed_fields: text[]
- reason: text
- ip_address: inet
- user_agent: text
- created_at: timestamp
```

---

### Database Functions

#### 1. `has_role(user_id, role)`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ä–æ–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
RETURNS boolean
```

#### 2. `get_user_profile_with_role()`
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –µ–≥–æ —Ä–æ–ª—å—é
```sql
RETURNS TABLE(id, email, full_name, ..., role)
SECURITY DEFINER
```

#### 3. `admin_get_user_profiles(limit, offset)`
–ê–¥–º–∏–Ω—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```sql
RETURNS TABLE(id, email, full_name, role, created_at, last_sign_in)
SECURITY DEFINER
```

#### 4. `update_activity_status(activity_id, new_status, user_notes)`
–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ activity_states
```sql
RETURNS TABLE(id, title, status, updated_at)
SECURITY DEFINER
```

#### 5. `ensure_ai_session(session_id, user_id)`
–°–æ–∑–¥–∞–µ—Ç –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é AI —Å–µ—Å—Å–∏—é
```sql
RETURNS TABLE(session_id, is_new)
```

#### 6. `log_profile_access(accessed_user_id, access_type, accessed_fields, reason)`
–õ–æ–≥–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –∞–¥–º–∏–Ω–∞ –∫ –ø—Ä–æ—Ñ–∏–ª—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
RETURNS void
SECURITY DEFINER
```

#### 7. `sync_user_profile()`
Trigger function –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ auth.users –∏ profiles
```sql
RETURNS trigger
SECURITY DEFINER
```

#### 8. `handle_new_user_role()`
Trigger function –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```sql
RETURNS trigger
SECURITY DEFINER
```

#### 9. `notify_n8n_webhook()` / `simple_webhook_trigger()`
Trigger functions –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤–Ω–µ—à–Ω–∏–π webhook (n8n)
```sql
RETURNS trigger
SECURITY DEFINER
```

#### 10. `update_updated_at_column()`
–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π trigger –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—è updated_at
```sql
RETURNS trigger
```

---

### Database Triggers

#### 1. –ù–∞ —Ç–∞–±–ª–∏—Ü–µ `auth.users`
```sql
TRIGGER on_auth_user_created
AFTER INSERT
EXECUTE FUNCTION sync_user_profile()
```
–°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ profiles –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```sql
TRIGGER on_new_user_role
AFTER INSERT
EXECUTE FUNCTION handle_new_user_role()
```
–ù–∞–∑–Ω–∞—á–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—É—é —Ä–æ–ª—å 'user'

#### 2. –ù–∞ —Ç–∞–±–ª–∏—Ü–µ `ai_diary_messages`
```sql
TRIGGER ai_diary_messages_webhook
AFTER INSERT
EXECUTE FUNCTION simple_webhook_trigger()
```
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç user —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ webhook n8n –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ AI

#### 3. –ù–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö —Å updated_at
```sql
TRIGGER update_[table]_updated_at
BEFORE UPDATE
EXECUTE FUNCTION update_updated_at_column()
```

---

## üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** (`/auth` - Register):
   - Email + Password + Full Name (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - `supabase.auth.signUp()` —Å emailRedirectTo
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ profile —á–µ—Ä–µ–∑ trigger
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–∏ 'user'
   - Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è)

2. **–í—Ö–æ–¥** (`/auth` - Login):
   - Email + Password
   - `supabase.auth.signInWithPassword()`
   - –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö auth —Ç–æ–∫–µ–Ω–æ–≤
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`

3. **–í—ã—Ö–æ–¥**:
   - `supabase.auth.signOut({ scope: 'global' })`
   - –û—á–∏—Å—Ç–∫–∞ localStorage (auth —Ç–æ–∫–µ–Ω—ã, onboarding –¥–∞–Ω–Ω—ã–µ)
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/auth`

### –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π

**–†–æ–ª–∏**: 
- `user` - –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `admin` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

**–ê–¥–º–∏–Ω—Å–∫–∏–µ –ø—Ä–∞–≤–∞**:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`admin_get_user_profiles`)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (practices, tests, strategies)
- –î–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º (`profile_access_logs`)

### RLS (Row Level Security)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ
- –ê–¥–º–∏–Ω—ã –∏–º–µ—é—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –ü—É–±–ª–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (practices) –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º –ø—Ä–∏ —Å—Ç–∞—Ç—É—Å–µ 'published'

---

## üîÑ Realtime –ø–æ–¥–ø–∏—Å–∫–∏

### 1. AI Diary Messages
```typescript
// –í AIDiaryService
supabase
  .channel(`ai_diary_${sessionId}`)
  .on('postgres_changes', {
    event: 'INSERT',
    schema: 'public',
    table: 'ai_diary_messages',
    filter: `session_id=eq.${sessionId}`
  }, (payload) => {
    if (payload.new.message_type === 'ai') {
      onNewMessage(payload.new);
    }
  })
  .subscribe();
```

### 2. Activities Realtime
```typescript
// –í useActivitiesRealtime
supabase
  .channel('activities_changes')
  .on('postgres_changes', {
    event: '*', // INSERT, UPDATE, DELETE
    schema: 'public',
    table: 'activities',
    filter: `user_id=eq.${userId}`
  }, handleChange)
  .subscribe();
```

---

## ü§ñ AI –î–Ω–µ–≤–Ω–∏–∫ - –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ AI –î–Ω–µ–≤–Ω–∏–∫–∞

```
User (Frontend)
    ‚Üì 1. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
AIDiaryService.sendMessage()
    ‚Üì 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
Supabase: ai_diary_messages (type: 'user')
    ‚Üì 3. Database Trigger
simple_webhook_trigger() ‚Üí HTTP POST
    ‚Üì 4. –í–Ω–µ—à–Ω–∏–π webhook
n8n (https://mentalbalans.com/webhook/ai-diary-supabase)
    ‚Üì 5. AI –æ–±—Ä–∞–±–æ—Ç–∫–∞ (OpenAI/–¥—Ä—É–≥–∏–µ –º–æ–¥–µ–ª–∏)
n8n –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç
    ‚Üì 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞
Supabase: ai_diary_messages (type: 'ai')
    ‚Üì 7. Realtime —Å–æ–±—ã—Ç–∏–µ
Supabase Realtime ‚Üí Frontend
    ‚Üì 8. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI
useAIDiaryChat –æ–±–Ω–æ–≤–ª—è–µ—Ç messages
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã AI –î–Ω–µ–≤–Ω–∏–∫–∞

**–ü—É—Ç—å**: `src/components/dashboard/ai-diary-scenarios/`

1. **FreeChat.tsx** - –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è
2. **FreeChatMessages.tsx** - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
3. **FreeChatInput.tsx** - –ü–æ–ª–µ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
4. **FreeChatHeader.tsx** - –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏—è–º–∏

**Hooks**:
- `useAIDiaryChat.ts` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞, –æ—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- `useAIDiaryAnalytics.ts` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å–µ—Å—Å–∏—è–º –∏ —Ç–µ–º–∞–º
- `useDiaryState.ts` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –¥–Ω–µ–≤–Ω–∏–∫–∞

**Services**:
- `ai-diary.service.ts` - –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –∏ Realtime
- `ai-diary-analytics.service.ts` - –ê–Ω–∞–ª–∏–∑ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ —Ç–æ–ø–∏–∫–æ–≤

### –ü—Ä–æ—Ü–µ—Å—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è

```typescript
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç Enter
const sendMessage = async (messageText: string) => {
  // 2. –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ UI
  const userMsg = {
    id: generateId(),
    type: 'user',
    content: messageText,
    timestamp: new Date()
  };
  setMessages(prev => [...prev, userMsg]);

  // 3. –î–æ–±–∞–≤–ª—è–µ–º placeholder "AI –ø–µ—á–∞—Ç–∞–µ—Ç..."
  setMessages(prev => [...prev, {
    id: 'typing',
    type: 'ai',
    content: '',
    isTyping: true
  }]);

  // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –ë–î —á–µ—Ä–µ–∑ AIDiaryService
  await AIDiaryService.sendMessage(messageText, sessionId);
  
  // 5. –ñ–¥–µ–º Realtime —Å–æ–±—ã—Ç–∏–µ —Å AI –æ—Ç–≤–µ—Ç–æ–º
  // (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ handleNewAIMessage)
};

// 6. –ü–æ–ª—É—á–µ–Ω–∏–µ AI –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ Realtime
const handleNewAIMessage = (message: any) => {
  // –£–±–∏—Ä–∞–µ–º placeholder
  setMessages(prev => prev.filter(m => m.id !== 'typing'));
  
  // –î–æ–±–∞–≤–ª—è–µ–º AI —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø–µ—á–∞—Ç–∏
  typeMessage(message.content, message.id, message.metadata?.suggestions);
};
```

### –§–æ—Ä–º–∞—Ç AI –æ—Ç–≤–µ—Ç–∞

```json
{
  "id": "uuid",
  "message_type": "ai",
  "content": "–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ AI...",
  "metadata": {
    "suggestions": ["–í–∞—Ä–∏–∞–Ω—Ç 1", "–í–∞—Ä–∏–∞–Ω—Ç 2", "–í–∞—Ä–∏–∞–Ω—Ç 3"],
    "topics": ["anxiety", "stress"],
    "sentiment": "positive",
    "processed": true
  }
}
```

### –°–µ—Å—Å–∏–∏ AI –î–Ω–µ–≤–Ω–∏–∫–∞

**–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏**:
```typescript
const startNewSession = async () => {
  const newSessionId = `ai_diary_${Date.now()}_${randomString}`;
  await AIDiaryService.startNewSession();
  localStorage.setItem('ai_diary_session_id', newSessionId);
};
```

**–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏**:
```typescript
const loadHistory = async (sessionId: string) => {
  const messages = await AIDiaryService.loadSessionHistory(sessionId);
  setMessages(messages.map(formatMessage));
};
```

**–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏**:
```typescript
const endSession = async () => {
  await AIDiaryService.endSession(sessionId);
  localStorage.removeItem('ai_diary_session_id');
};
```

### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ AI –î–Ω–µ–≤–Ω–∏–∫–∞

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `AIDiaryStats.tsx`

**–ú–µ—Ç—Ä–∏–∫–∏**:
1. **–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   - –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
   - –°—Ä–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —Å–µ—Å—Å–∏—é
   - –í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π

2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏**:
   - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

3. **–¢–æ–ø —Ç–µ–º—ã**:
   - –ß–∞—Å—Ç–æ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
   - –¢–æ–ø-5 –æ–±—Å—É–∂–¥–∞–µ–º—ã—Ö —Ç–µ–º

**–°–µ—Ä–≤–∏—Å**: `ai-diary-analytics.service.ts`

---

## üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è

**–ü—É—Ç—å**: `src/components/calendar/`

**–í–∏–¥—ã**:
1. **MonthView** - –ú–µ—Å—è—á–Ω—ã–π –≤–∏–¥
2. **WeekView** - –ù–µ–¥–µ–ª—å–Ω—ã–π –≤–∏–¥
3. **DayView** - –î–Ω–µ–≤–Ω–æ–π –≤–∏–¥ (–¥–µ—Ç–∞–ª—å–Ω—ã–π)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞–ª–µ–Ω–¥–∞—Ä—è

```
Calendar/
‚îú‚îÄ‚îÄ CalendarHeader.tsx       # –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–æ–≤
‚îú‚îÄ‚îÄ CalendarControls.tsx     # –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ MonthView.tsx            # –ú–µ—Å—è—á–Ω–∞—è —Å–µ—Ç–∫–∞
‚îú‚îÄ‚îÄ WeekView.tsx             # –ù–µ–¥–µ–ª—å–Ω–∞—è —Å–µ—Ç–∫–∞
‚îú‚îÄ‚îÄ DayView.tsx              # –î–µ—Ç–∞–ª—å–Ω—ã–π –¥–Ω–µ–≤–Ω–æ–π –≤–∏–¥
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ActivityCard.tsx     # –ö–∞—Ä—Ç–æ—á–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ DayActivityCard.tsx  # –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –¥–Ω–µ–≤–Ω–æ–≥–æ –≤–∏–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ WeekActivityCard.tsx # –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–ª—è –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ CreateActivityDialog.tsx  # –î–∏–∞–ª–æ–≥ —Å–æ–∑–¥–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ EditActivityDialog.tsx    # –î–∏–∞–ª–æ–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ DeleteRecurringDialog.tsx # –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è
‚îÇ   ‚îú‚îÄ‚îÄ CurrentTimeIndicator.tsx  # –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
‚îÇ   ‚îî‚îÄ‚îÄ TimeColumn.tsx            # –ö–æ–ª–æ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ timeUtils.tsx        # –£—Ç–∏–ª–∏—Ç—ã —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
    ‚îú‚îÄ‚îÄ recurringUtils.ts    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
    ‚îî‚îÄ‚îÄ recurrenceExpansion.ts # –†–∞–∑–≤–µ—Ä—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
```

### –¢–∏–ø—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

**–¢–∞–±–ª–∏—Ü–∞**: `activity_types`

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –¶–≤–µ—Ç | –ò–∫–æ–Ω–∫–∞ |
|----|----------|------|--------|
| 1 | –†–∞–±–æ—Ç–∞ | #3B82F6 | üíº |
| 2 | –û—Ç–¥—ã—Ö | #10B981 | üå¥ |
| 3 | –°–ø–æ—Ä—Ç | #F59E0B | üèÉ |
| 4 | –û–±—â–µ–Ω–∏–µ | #8B5CF6 | üë• |
| 5 | –•–æ–±–±–∏ | #EC4899 | üé® |
| ... | ... | ... | ... |

### –°—Ç–∞—Ç—É—Å—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

- `planned` - –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
- `in_progress` - –í –ø—Ä–æ—Ü–µ—Å—Å–µ
- `completed` - –ó–∞–≤–µ—Ä—à–µ–Ω–æ
- `cancelled` - –û—Ç–º–µ–Ω–µ–Ω–æ

### Recurring (–ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è) –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**Metadata —Ñ–æ—Ä–º–∞—Ç**:
```json
{
  "isRecurring": true,
  "recurrencePattern": {
    "frequency": "daily" | "weekly" | "monthly",
    "interval": 1,
    "daysOfWeek": [1, 3, 5], // –ü–Ω, –°—Ä, –ü—Ç
    "endDate": "2024-12-31"
  },
  "recurringGroupId": "uuid"
}
```

**–õ–æ–≥–∏–∫–∞**:
1. –°–æ–∑–¥–∞–µ—Ç—Å—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å `isRecurring: true`
2. –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
3. –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ - –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞: "–¢–æ–ª—å–∫–æ —ç—Ç—É" –∏–ª–∏ "–í—Å–µ –≤ —Å–µ—Ä–∏–∏"
4. –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ

### Hooks –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è

```typescript
// –û—Å–Ω–æ–≤–Ω–æ–π —Ö—É–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
useCalendarView(view: 'month'|'week'|'day')

// –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
useActivities(startDate, endDate)

// Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
useActivitiesRealtime(userId)

// –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é
useCalendarNavigation(currentDate, view)
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏

**–°–æ–∑–¥–∞–Ω–∏–µ**:
```typescript
const createActivity = async (data: ActivityData) => {
  const { data: activity, error } = await supabase
    .from('activities')
    .insert({
      user_id: userId,
      activity_type_id: data.typeId,
      title: data.title,
      start_time: data.startTime,
      end_time: data.endTime,
      status: 'planned',
      metadata: data.metadata
    })
    .select()
    .single();
  
  return activity;
};
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞**:
```typescript
const updateStatus = async (activityId: string, newStatus: string) => {
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç database function
  const { data } = await supabase.rpc('update_activity_status', {
    activity_id: activityId,
    new_status: newStatus,
    user_notes: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ'
  });
};
```

**–£–¥–∞–ª–µ–Ω–∏–µ**:
```typescript
const deleteActivity = async (activityId: string) => {
  await supabase
    .from('activities')
    .delete()
    .eq('id', activityId);
};
```

---

## üìî –î–Ω–µ–≤–Ω–∏–∫–∏ (Diaries)

### –¢–∏–ø—ã –¥–Ω–µ–≤–Ω–∏–∫–æ–≤

**–ü—É—Ç—å**: `src/components/diaries/`

1. **MoodDiary** - –î–Ω–µ–≤–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
2. **SleepDiary** - –î–Ω–µ–≤–Ω–∏–∫ —Å–Ω–∞
3. **ThoughtsDiary** - –î–Ω–µ–≤–Ω–∏–∫ –º—ã—Å–ª–µ–π
4. **OCDDiary** - –î–Ω–µ–≤–Ω–∏–∫ –û–ö–†
5. **ProcrastinationDiary** - –î–Ω–µ–≤–Ω–∏–∫ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏
6. **SelfEsteemDiary** - –î–Ω–µ–≤–Ω–∏–∫ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∏
7. **DepressionCareDiary** - –î–Ω–µ–≤–Ω–∏–∫ –∑–∞–±–æ—Ç—ã –ø—Ä–∏ –¥–µ–ø—Ä–µ—Å—Å–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Mood Diary

**–®–∞–≥–∏**:
1. **MoodStep** - –û—Ü–µ–Ω–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (1-10)
2. **EmotionsStep** - –í—ã–±–æ—Ä —ç–º–æ—Ü–∏–π —Å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å—é
3. **ClarifyingQuestionsStep** - –£—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
4. **SelfEvaluationStep** - –°–∞–º–æ–æ—Ü–µ–Ω–∫–∞ —Å–∏—Ç—É–∞—Ü–∏–∏
5. **RecommendationsStep** - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
```
diaries/mood/
‚îú‚îÄ‚îÄ MoodStep.tsx
‚îú‚îÄ‚îÄ EmotionsStep.tsx
‚îú‚îÄ‚îÄ ClarifyingQuestionsStep.tsx
‚îú‚îÄ‚îÄ SelfEvaluationStep.tsx
‚îú‚îÄ‚îÄ RecommendationsStep.tsx
‚îú‚îÄ‚îÄ constants.ts    # –°–ø–∏—Å–∫–∏ —ç–º–æ—Ü–∏–π, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ types.ts        # TypeScript —Ç–∏–ø—ã
```

**–î–∞–Ω–Ω—ã–µ —ç–º–æ—Ü–∏–π** (constants.ts):
```typescript
export const EMOTIONS = [
  { value: '—Ä–∞–¥–æ—Å—Ç—å', label: '–†–∞–¥–æ—Å—Ç—å', emoji: 'üòä', color: 'yellow' },
  { value: '–≥—Ä—É—Å—Ç—å', label: '–ì—Ä—É—Å—Ç—å', emoji: 'üò¢', color: 'blue' },
  { value: '—Ç—Ä–µ–≤–æ–≥–∞', label: '–¢—Ä–µ–≤–æ–≥–∞', emoji: 'üò∞', color: 'orange' },
  { value: '–≥–Ω–µ–≤', label: '–ì–Ω–µ–≤', emoji: 'üò†', color: 'red' },
  // ... –∏ —Ç.–¥.
];

export const TRIGGERS = [
  '–†–∞–±–æ—Ç–∞', '–û—Ç–Ω–æ—à–µ–Ω–∏—è', '–ó–¥–æ—Ä–æ–≤—å–µ', '–§–∏–Ω–∞–Ω—Å—ã',
  '–°–µ–º—å—è', '–î—Ä—É–∑—å—è', '–û–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ', '–ë—É–¥—É—â–µ–µ'
];
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**:
```typescript
const saveMoodEntry = async (data: MoodDiaryData) => {
  await supabase.from('mood_diary_entries').insert({
    user_id: userId,
    mood_score: data.moodScore,
    emotions: data.emotions, // jsonb
    triggers: data.triggers,
    physical_sensations: data.sensations,
    body_areas: data.bodyAreas,
    context: data.context,
    notes: data.notes
  });
};
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Sleep Diary

**–®–∞–≥–∏**:
1. **Step1Sleep** - –í—Ä–µ–º—è —Å–Ω–∞ –∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è
2. **Step2Quality** - –ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞
3. **Step3Factors** - –§–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è–Ω–∏—è
4. **Step4Rest** - –î–Ω–µ–≤–Ω–æ–π –æ—Ç–¥—ã—Ö
5. **Step5Impact** - –û–±—â–µ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å

**–î–∞–Ω–Ω—ã–µ**:
```typescript
interface SleepDiaryData {
  bedtime: string;           // "23:30"
  wakeUpTime: string;        // "07:00"
  sleepDuration: number;     // –≤ —á–∞—Å–∞—Ö
  sleepQuality: number;      // 1-10
  nightAwakenings: number;
  morningFeeling: number;    // 1-10
  hasDayRest: boolean;
  dayRestType?: string;
  dayRestEffectiveness?: number;
  overallSleepImpact: number;
  sleepDisruptors: string[];
  sleepComment?: string;
  recommendations: string[];
}
```

### Hook –¥–ª—è –¥–Ω–µ–≤–Ω–∏–∫–æ–≤

```typescript
// –î–ª—è Mood Diary
const useMoodDiary = () => {
  const [currentStep, setCurrentStep] = useState(1);
  const [formData, setFormData] = useState<MoodDiaryData>({});
  
  const saveEntry = async () => {
    await supabase.from('mood_diary_entries').insert(formData);
  };
  
  return { currentStep, formData, setFormData, saveEntry };
};

// –î–ª—è Sleep Diary
const useSleepDiary = () => {
  // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ
};
```

---

## üßò –ü—Ä–∞–∫—Ç–∏–∫–∏ (Practices)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–∫—Ç–∏–∫

**–ü—É—Ç—å**: `src/components/practices/`

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
```
practices/
‚îú‚îÄ‚îÄ PracticeDetailModal.tsx     # –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä
‚îú‚îÄ‚îÄ PracticeContentCard.tsx     # –ö–∞—Ä—Ç–æ—á–∫–∞ –ø—Ä–∞–∫—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ PracticesSearchFilters.tsx  # –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã
‚îú‚îÄ‚îÄ CreatePracticeDialog.tsx    # –°–æ–∑–¥–∞–Ω–∏–µ (–∞–¥–º–∏–Ω)
‚îú‚îÄ‚îÄ CreateActivityFromPracticeDialog.tsx  # –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ detail/
    ‚îú‚îÄ‚îÄ PracticeInfo.tsx        # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ PracticeActions.tsx     # –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
    ‚îú‚îÄ‚îÄ TestSection.tsx         # –†–∞–∑–¥–µ–ª —Ç–µ—Å—Ç–æ–≤
    ‚îî‚îÄ‚îÄ useTestLogic.ts         # –õ–æ–≥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–∞–∫—Ç–∏–∫

- –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
- –ú–µ–¥–∏—Ç–∞—Ü–∏—è
- –†–µ–ª–∞–∫—Å–∞—Ü–∏—è
- –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏
- –§–∏–∑–∏—á–µ—Å–∫–∏–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
- Mindfulness

### –£—Ä–æ–≤–Ω–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

```typescript
enum DifficultyLevel {
  beginner = '–ù–∞—á–∞–ª—å–Ω—ã–π',
  intermediate = '–°—Ä–µ–¥–Ω–∏–π',
  advanced = '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π'
}
```

### –°—Ç–∞—Ç—É—Å—ã –ø—Ä–∞–∫—Ç–∏–∫

```typescript
enum ContentStatus {
  draft = '–ß–µ—Ä–Ω–æ–≤–∏–∫',
  published = '–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ',
  archived = '–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–æ'
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏

```typescript
const createActivityFromPractice = async (
  practice: Practice,
  scheduledTime: Date
) => {
  await supabase.from('activities').insert({
    user_id: userId,
    activity_type_id: PRACTICE_ACTIVITY_TYPE_ID,
    title: practice.title,
    description: practice.description,
    start_time: scheduledTime,
    end_time: addMinutes(scheduledTime, practice.duration_minutes),
    status: 'planned',
    metadata: {
      practiceId: practice.id,
      instructions: practice.instructions,
      benefits: practice.benefits
    }
  });
};
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (Statistics)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

**–ü—É—Ç—å**: `src/components/statistics/`

```
statistics/
‚îú‚îÄ‚îÄ MoodEmotionsChart.tsx   # –ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ —ç–º–æ—Ü–∏–π
‚îú‚îÄ‚îÄ SleepChart.tsx          # –ì—Ä–∞—Ñ–∏–∫ —Å–Ω–∞
‚îú‚îÄ‚îÄ MockDataInspector.tsx   # –ò–Ω—Å–ø–µ–∫—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö (dev)
‚îî‚îÄ‚îÄ chart-utils/
    ‚îú‚îÄ‚îÄ chartComponents.tsx     # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    ‚îú‚îÄ‚îÄ chartDataConverters.ts  # –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö
    ‚îî‚îÄ‚îÄ chartDataService.ts     # –°–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
```

### –¢–∏–ø—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤

1. **Mood Chart** - –õ–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
   - –û—Å—å X: –î–∞—Ç–∞
   - –û—Å—å Y: –û—Ü–µ–Ω–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è (1-10)
   - –§–∏–ª—å—Ç—Ä—ã: –î–µ–Ω—å, –ù–µ–¥–µ–ª—è, –ú–µ—Å—è—Ü

2. **Emotions Chart** - –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ —ç–º–æ—Ü–∏–π
   - –ß–∞—Å—Ç–æ—Ç–∞ –∫–∞–∂–¥–æ–π —ç–º–æ—Ü–∏–∏
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–µ—Ä–∏–æ–¥–∞–º

3. **Sleep Chart** - –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫
   - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–Ω–∞ (bars)
   - –ö–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞ (line)
   - –ü—Ä–æ–±—É–∂–¥–µ–Ω–∏—è –Ω–æ—á—å—é (scatter)

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤

```typescript
const getChartData = async (
  userId: string,
  type: 'mood' | 'sleep',
  period: 'day' | 'week' | 'month'
) => {
  const { startDate, endDate } = calculatePeriod(period);
  
  if (type === 'mood') {
    const { data } = await supabase
      .from('mood_diary_entries')
      .select('*')
      .eq('user_id', userId)
      .gte('created_at', startDate)
      .lte('created_at', endDate)
      .order('created_at');
    
    return convertToChartFormat(data);
  }
  
  // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è sleep
};
```

---

## üéØ –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (Onboarding)

### –ü—Ä–æ—Ü–µ—Å—Å –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

**–ü—É—Ç—å**: `src/components/onboarding/`

**–®–∞–≥–∏**:
1. WelcomeScreen - –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
2. BasicInfo - –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
3. GoalsScreen - –¶–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. ChallengesScreen - –¢–µ–∫—É—â–∏–µ —Ç—Ä—É–¥–Ω–æ—Å—Ç–∏
5. CurrentStateScreen - –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
6. AnxietyScreen - –£—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏
7. ProcrastinationScreen - –ü—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è
8. ChronotypeScreen - –•—Ä–æ–Ω–æ—Ç–∏–ø
9. NaturalRhythmsScreen - –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∏—Ç–º—ã
10. PreferencesScreen - –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
11. PersonalizationScreen - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
12. SocialSupportScreen - –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
13. ProfessionalHelpScreen - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–º–æ—â—å
14. EmailVerification - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è email
15. ConfirmationScreen - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
16. WelcomeComplete - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ

### –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞

**localStorage**:
```typescript
localStorage.setItem('onboarding-data', JSON.stringify(data));
localStorage.setItem('onboarding-completed', 'true');
```

**–û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä** (–ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏):
```typescript
const submitOnboarding = async (data: OnboardingData) => {
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  await supabase.from('profiles').update({
    full_name: data.fullName,
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
  }).eq('id', userId);
  
  // –ú–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏–ª–∏ –≤ metadata –ø—Ä–æ—Ñ–∏–ª—è
};
```

---

## üîó –†–æ—É—Ç–∏–Ω–≥

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

**–§–∞–π–ª**: `src/App.tsx`

```typescript
<Routes>
  {/* –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã */}
  <Route path="/" element={<Index />} />
  <Route path="/auth" element={<Auth />} />
  <Route path="/about" element={<About />} />
  <Route path="/for-professionals" element={<ForProfessionals />} />
  <Route path="/knowledge-base" element={<KnowledgeBase />} />
  <Route path="/article/:slug" element={<ArticleView />} />
  
  {/* –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏) */}
  <Route path="/dashboard" element={
    <ProtectedRoute><Dashboard /></ProtectedRoute>
  } />
  <Route path="/calendar" element={
    <ProtectedRoute><Calendar /></ProtectedRoute>
  } />
  <Route path="/practices" element={
    <ProtectedRoute><DashboardPractices /></ProtectedRoute>
  } />
  <Route path="/diaries" element={
    <ProtectedRoute><Diaries /></ProtectedRoute>
  } />
  <Route path="/statistics" element={
    <ProtectedRoute><Statistics /></ProtectedRoute>
  } />
  
  {/* –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–Ω–µ–≤–Ω–∏–∫–æ–≤ */}
  <Route path="/mood-diary" element={
    <ProtectedRoute><MoodDiaryPage /></ProtectedRoute>
  } />
  <Route path="/sleep-diary" element={
    <ProtectedRoute><SleepDiaryPage /></ProtectedRoute>
  } />
  <Route path="/thoughts-diary" element={
    <ProtectedRoute><ThoughtsDiaryPage /></ProtectedRoute>
  } />
  <Route path="/ocd-diary" element={
    <ProtectedRoute><OCDDiaryPage /></ProtectedRoute>
  } />
  <Route path="/procrastination-diary" element={
    <ProtectedRoute><ProcrastinationDiaryPage /></ProtectedRoute>
  } />
  <Route path="/self-esteem-diary" element={
    <ProtectedRoute><SelfEsteemDiaryPage /></ProtectedRoute>
  } />
  <Route path="/depression-care-diary" element={
    <ProtectedRoute><DepressionCareDiaryPage /></ProtectedRoute>
  } />
  
  {/* 404 */}
  <Route path="*" element={<NotFound />} />
</Routes>
```

### ProtectedRoute –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```typescript
const ProtectedRoute = ({ children }: { children: React.ReactNode }) => {
  const { isAuthenticated, isLoading } = useSupabaseAuth();
  
  if (isLoading) {
    return <LoadingSpinner />;
  }
  
  if (!isAuthenticated) {
    return <Navigate to="/auth" replace />;
  }
  
  return <>{children}</>;
};
```

---

## üåê –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### n8n Webhook

**URL**: `https://mentalbalans.com/webhook/ai-diary-supabase`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ AI –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ü—Ä–æ—Ü–µ—Å—Å**:
1. User –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Üí `ai_diary_messages` (type: 'user')
2. Database trigger –≤—ã–∑—ã–≤–∞–µ—Ç `simple_webhook_trigger()`
3. –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ webhook
4. n8n –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ AI –º–æ–¥–µ–ª—å
5. n8n —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí `ai_diary_messages` (type: 'ai')
6. Realtime —Å–æ–±—ã—Ç–∏–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É

**Payload —Ñ–æ—Ä–º–∞—Ç**:
```json
{
  "record": {
    "id": "uuid",
    "user_id": "uuid",
    "session_id": "varchar",
    "message_type": "user",
    "content": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",
    "metadata": {},
    "created_at": "timestamp"
  },
  "table": "ai_diary_messages"
}
```

---

## üé® Design System

### –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ (index.css)

```css
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --primary: 221.2 83.2% 53.3%;
  --primary-foreground: 210 40% 98%;
  --secondary: 210 40% 96.1%;
  --secondary-foreground: 222.2 47.4% 11.2%;
  --muted: 210 40% 96.1%;
  --muted-foreground: 215.4 16.3% 46.9%;
  --accent: 210 40% 96.1%;
  --accent-foreground: 222.2 47.4% 11.2%;
  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;
  /* ... –∏ —Ç.–¥. */
}

.dark {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  /* ... —Ç–µ–º–Ω–∞—è —Ç–µ–º–∞ */
}
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI (shadcn/ui)

**–ü—É—Ç—å**: `src/components/ui/`

- Button, Card, Dialog, Dropdown, Input
- Select, Tabs, Toast, Tooltip
- Sheet, Popover, Calendar –∏ —Ç.–¥.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:
```typescript
import { Button } from '@/components/ui/button';
import { Card, CardHeader, CardTitle } from '@/components/ui/card';
```

---

## üì¶ –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã (Contexts)

### 1. SupabaseAuthContext
```typescript
interface SupabaseAuthContextType {
  user: User | null;
  session: Session | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  signIn: (email, password) => Promise<void>;
  signUp: (email, password, fullName?) => Promise<void>;
  signOut: () => Promise<void>;
}
```

### 2. PersonalizationContext
–•—Ä–∞–Ω–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. ActivitiesContext
–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π

### 4. DiaryStatusContext
–°—Ç–∞—Ç—É—Å—ã –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–∏–∫–æ–≤

---

## üîß –°–µ—Ä–≤–∏—Å—ã (Services)

### 1. ai-diary.service.ts
```typescript
class AIDiaryService {
  // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
  sendMessage(message: string, sessionId: string): Promise<any>
  
  // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  subscribeToMessages(sessionId: string, onNewMessage: Function)
  
  // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
  loadSessionHistory(sessionId: string): Promise<Message[]>
  
  // –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
  startNewSession(): Promise<string>
  
  // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
  endSession(sessionId: string): Promise<void>
}
```

### 2. activity.service.ts
```typescript
class ActivityService {
  // CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
  createActivity(data: ActivityData): Promise<Activity>
  updateActivity(id: string, data: Partial<ActivityData>): Promise<Activity>
  deleteActivity(id: string): Promise<void>
  
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
  getActivities(userId: string, startDate: Date, endDate: Date): Promise<Activity[]>
  
  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
  updateStatus(id: string, status: string): Promise<Activity>
}
```

### 3. unified-activity.service.ts
–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—è–º–∏ (Supabase + localStorage fallback)

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ —Ö—É–∫–∏ (Hooks)

### API Hooks

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —Å React Query
useActivities(startDate: Date, endDate: Date)

// Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
useActivitiesRealtime(userId: string)

// –ú—É—Ç–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
useActivitiesApi()
  .createActivity.mutate(data)
  .updateActivity.mutate({ id, data })
  .deleteActivity.mutate(id)

// –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
useActivitiesInvalidation()
```

### Feature Hooks

```typescript
// –õ–æ–≥–∏–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
useCalendarView(view: 'month' | 'week' | 'day')
useCalendarNavigation(currentDate: Date, view: string)

// –î–Ω–µ–≤–Ω–∏–∫–∏
useMoodDiary()
useSleepDiary()

// AI –ß–∞—Ç
useAIDiaryChat()
useAIDiaryAnalytics(sessionId: string, messages: Message[])

// Dashboard
useDashboardScroll()
useActivityTimelineLogic()
```

---

## üìù –¢–∏–ø—ã (Types)

### Activity Types

```typescript
interface Activity {
  id: string;
  user_id: string;
  activity_type_id: number;
  title: string;
  description?: string;
  start_time: string;
  end_time?: string;
  status: 'planned' | 'in_progress' | 'completed' | 'cancelled';
  metadata?: {
    isRecurring?: boolean;
    recurrencePattern?: RecurrencePattern;
    recurringGroupId?: string;
    [key: string]: any;
  };
  created_at: string;
  updated_at: string;
}

interface RecurrencePattern {
  frequency: 'daily' | 'weekly' | 'monthly';
  interval: number;
  daysOfWeek?: number[];
  endDate?: string;
}
```

### Diary Types

```typescript
interface MoodDiaryEntry {
  id: string;
  user_id: string;
  mood_score: number;
  emotions: Array<{
    emotion: string;
    intensity: number;
  }>;
  triggers: string[];
  physical_sensations: string[];
  body_areas: string[];
  context?: string;
  notes?: string;
  created_at: string;
}

interface SleepDiaryEntry {
  id: string;
  user_id: string;
  bedtime: string;
  wake_up_time: string;
  sleep_duration: number;
  sleep_quality: number;
  night_awakenings: number;
  morning_feeling: number;
  has_day_rest: boolean;
  day_rest_type?: string;
  day_rest_effectiveness?: number;
  overall_sleep_impact: number;
  sleep_disruptors: string[];
  sleep_comment?: string;
  recommendations: string[];
  created_at: string;
}
```

### AI Diary Types

```typescript
interface Message {
  id: string;
  type: 'user' | 'ai';
  content: string;
  timestamp: Date;
  session_id?: string;
  isTyping?: boolean;
  suggestions?: string[];
}

interface DiarySession {
  id: string;
  session_id: string;
  user_id: string;
  started_at: string;
  ended_at?: string;
  summary?: string;
  insights?: any;
  emotional_state?: any;
}
```

---

## üöÄ –î–µ–ø–ª–æ–π –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### Environment Variables

```bash
# –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è VITE_* –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ!
# URL –≤—Å—Ç—Ä–æ–µ–Ω –Ω–∞–ø—Ä—è–º—É—é –≤ –∫–æ–¥ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
SUPABASE_URL=https://szvousyzsqdpubgfycdy.supabase.co
SUPABASE_ANON_KEY=eyJhbGci...
```

### Build & Deploy

```bash
# –°–±–æ—Ä–∫–∞
npm run build

# Preview
npm run preview

# Deploy (—á–µ—Ä–µ–∑ Lovable –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **RLS Policies** –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö
2. **SECURITY DEFINER** –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π
3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞** (profile_access_logs)
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (Zod schemas)
5. **–û—á–∏—Å—Ç–∫–∞ auth —Ç–æ–∫–µ–Ω–æ–≤** –ø—Ä–∏ logout
6. **HTTP-only cookies** (—á–µ—Ä–µ–∑ Supabase Auth)

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–§–∞–π–ª**: `src/utils/securityLogger.ts`

```typescript
class SecurityLogger {
  logAuthSuccess(email: string, userId: string)
  logAuthFailure(email: string, reason: string, metadata?: any)
  logSuspiciousActivity(userId: string, activity: string, metadata?: any)
}
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### React Query DevTools

–í–∫–ª—é—á–µ–Ω—ã –≤ development mode:
```typescript
<ReactQueryDevtools initialIsOpen={false} />
```

### Console Logging

–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏:
```typescript
console.log('Auth state change:', event, session?.user?.email);
console.log('Activity created:', activity.id);
console.log('AI message received:', message.id);
```

### Error Handling

```typescript
try {
  await operation();
} catch (error) {
  console.error('Operation failed:', error);
  toast.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞');
  securityLogger.logError(error);
}
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –§–∞–π–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

- `README.md` - –û—Å–Ω–æ–≤–Ω–æ–π README
- `PROJECT_ARCHITECTURE.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª (–ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- `supabase/migrations/` - SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Supabase Dashboard**: https://supabase.com/dashboard/project/szvousyzsqdpubgfycdy
- **Auth Settings**: https://supabase.com/dashboard/project/szvousyzsqdpubgfycdy/auth/providers
- **Database Editor**: https://supabase.com/dashboard/project/szvousyzsqdpubgfycdy/editor
- **SQL Editor**: https://supabase.com/dashboard/project/szvousyzsqdpubgfycdy/sql/new

---

## üéì –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. User –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/auth`
2. –í—ã–±–∏—Ä–∞–µ—Ç "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
3. –ó–∞–ø–æ–ª–Ω—è–µ—Ç email, password, full name
4. –ö–ª–∏–∫ "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"
5. `supabase.auth.signUp()` —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ auth.users
6. Trigger `on_auth_user_created` —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ profiles
7. Trigger `on_new_user_role` –Ω–∞–∑–Ω–∞—á–∞–µ—Ç —Ä–æ–ª—å 'user'
8. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
9. User –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ `/dashboard`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

1. User –Ω–∞ `/dashboard` –∫–ª–∏–∫–∞–µ—Ç "–î–Ω–µ–≤–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è"
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è `MoodDiaryModal`
3. **–®–∞–≥ 1**: –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ (1-10)
4. **–®–∞–≥ 2**: –í—ã–±–∏—Ä–∞–µ—Ç —ç–º–æ—Ü–∏–∏ –∏ –∏—Ö –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
5. **–®–∞–≥ 3**: –û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
6. **–®–∞–≥ 4**: –ü—Ä–æ–≤–æ–¥–∏—Ç —Å–∞–º–æ–æ—Ü–µ–Ω–∫—É
7. **–®–∞–≥ 5**: –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
8. –ö–ª–∏–∫ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
9. `supabase.from('mood_diary_entries').insert(data)`
10. –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –ë–î
11. Realtime –æ–±–Ω–æ–≤–ª—è–µ—Ç UI (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ

1. User –Ω–∞ `/calendar`
2. –ö–ª–∏–∫ "–°–æ–∑–¥–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è `CreateActivityDialog`
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ç–∏–ø, –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞/–∫–æ–Ω—Ü–∞
5. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ
6. –ö–ª–∏–∫ "–°–æ–∑–¥–∞—Ç—å"
7. `ActivityService.createActivity(data)`
8. –ó–∞–ø–∏—Å—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `activities`
9. Realtime —É–≤–µ–¥–æ–º–ª—è–µ—Ç –æ –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
10. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è —Å –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û–±—â–µ–Ω–∏–µ —Å AI –¥–Ω–µ–≤–Ω–∏–∫–æ–º

1. User –Ω–∞ `/dashboard`, –≤–∫–ª–∞–¥–∫–∞ "AI –ß–∞—Ç"
2. –í–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ: "–°–µ–≥–æ–¥–Ω—è —á—É–≤—Å—Ç–≤—É—é —Ç—Ä–µ–≤–æ–≥—É"
3. –ö–ª–∏–∫ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
4. `AIDiaryService.sendMessage()` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `ai_diary_messages` (type: 'user')
5. Database trigger –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ n8n webhook
6. n8n –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–µ—Ä–µ–∑ AI –º–æ–¥–µ–ª—å (OpenAI/–¥—Ä—É–≥–∏–µ)
7. n8n —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ç–≤–µ—Ç –≤ `ai_diary_messages` (type: 'ai')
8. Realtime —Å–æ–±—ã—Ç–∏–µ –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É
9. `useAIDiaryChat` –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
10. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏
11. –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç AI –æ—Ç–≤–µ—Ç –∏ suggestions (–µ—Å–ª–∏ –µ—Å—Ç—å)

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

1. User –Ω–∞ `/statistics`
2. –í—ã–±–∏—Ä–∞–µ—Ç "–î–Ω–µ–≤–Ω–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è"
3. –í—ã–±–∏—Ä–∞–µ—Ç –ø–µ—Ä–∏–æ–¥: "–ù–µ–¥–µ–ª—è"
4. `chartDataService.getMoodData(userId, 'week')`
5. –ó–∞–ø—Ä–æ—Å –∫ `mood_diary_entries` –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é
6. –î–∞–Ω–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç –≥—Ä–∞—Ñ–∏–∫–∞
7. –û—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è –ª–∏–Ω–µ–π–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
8. –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å—Ä–µ–¥–Ω–µ–µ, —Ç—Ä–µ–Ω–¥)

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ –ø–æ–ª–Ω–æ–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ Mental Balance. –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â—É—é:

- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (RLS, SECURITY DEFINER)
- ‚úÖ Realtime –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (Supabase Realtime)
- ‚úÖ AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é (—á–µ—Ä–µ–∑ webhook –∫ n8n)
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (React Query, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (TypeScript, shadcn/ui)
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (Vite, lazy loading)

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–ª–µ–¥—É—é—Ç best practices React –∏ Supabase.
